import React, { useRef, useEffect, useState } from "react";
import "./index.css";
interface IErrorPopup {
  error: string;
  setError: (error: string) => void;
}
type ErrorPopupType = {
  error: string;
  setError: (error: string) => void;
};
const ErrorPopup: React.FC<ErrorPopupType> = ({
  error,
  setError,
}: IErrorPopup) => {
  const [faded, setFaded] = useState<boolean>(false);
  const fadedRef = useRef(faded);
  fadedRef.current = faded;
  const errorRef = useRef(error);
  errorRef.current = error;
  // useEffect on mount or error is changed
  useEffect(() => {
    if (errorRef.current != null) {
      const timer = setTimeout(() => {
        // Fade
        setFaded(true);
        const timer2 = setTimeout(() => {
          setError(null);
          setFaded(false);
        }, 500);
        return () => clearTimeout(timer2);
      }, 3500);
      return () => clearTimeout(timer);
    }
  }, [setError, error]);

  return (
    <>
      {error ? (
        <div className="errorPopup">
          <div className={`modal ${fadedRef?.current ? "faded" : ""}`}>
            <svg
              width="387"
              height="369"
              viewBox="0 0 387 369"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g filter="url(#filter1_d)">
                <path
                  className="errorsvg1"
                  d="M180.101 70.1951C186.217 66.8085 193.389 65.8639 200.174 67.5515C206.958 69.2391 212.852 73.4335 216.669 79.2909L217.689 80.9872L313.06 253.181C315.312 257.25 316.501 261.822 316.517 266.473C316.534 271.123 315.377 275.703 313.154 279.788C310.932 283.874 307.715 287.332 303.801 289.845C299.887 292.357 295.403 293.842 290.763 294.162L288.87 294.235H98.1526C93.5068 294.235 88.9359 293.065 84.8618 290.832C80.7877 288.6 77.3416 285.377 74.8417 281.461C72.3418 277.545 70.8687 273.063 70.5582 268.427C70.2477 263.792 71.1099 259.153 73.0653 254.939L73.9503 253.181L169.297 80.9872C171.811 76.4487 175.55 72.709 180.089 70.1951H180.101ZM296.933 262.105L201.55 89.9232C200.805 88.5816 199.736 87.4472 198.442 86.6231C197.147 85.7989 195.667 85.3109 194.136 85.2035C192.606 85.0961 191.072 85.3725 189.675 86.0078C188.278 86.6431 187.062 87.6171 186.136 88.8415L185.436 89.9232L90.0892 262.105C89.3582 263.422 88.961 264.898 88.9323 266.404C88.9037 267.91 89.2444 269.4 89.9248 270.743C90.6052 272.087 91.6044 273.244 92.8352 274.112C94.066 274.98 95.4907 275.534 96.9849 275.724L98.1526 275.798H288.87C290.375 275.797 291.858 275.427 293.187 274.721C294.516 274.015 295.653 272.994 296.497 271.747C297.341 270.501 297.867 269.067 298.028 267.57C298.19 266.074 297.983 264.56 297.425 263.162L296.933 262.105L201.55 89.9232L296.933 262.105V262.105ZM193.499 232.691C195.143 232.639 196.782 232.918 198.316 233.511C199.851 234.105 201.25 235 202.432 236.145C203.614 237.29 204.553 238.66 205.195 240.175C205.836 241.69 206.167 243.319 206.167 244.964C206.167 246.609 205.836 248.238 205.195 249.753C204.553 251.268 203.614 252.638 202.432 253.783C201.25 254.928 199.851 255.824 198.316 256.417C196.782 257.01 195.143 257.289 193.499 257.237C190.311 257.136 187.288 255.799 185.068 253.509C182.849 251.218 181.608 248.154 181.608 244.964C181.608 241.775 182.849 238.71 185.068 236.42C187.288 234.129 190.311 232.792 193.499 232.691V232.691ZM193.438 140.479C195.666 140.476 197.819 141.279 199.501 142.741C201.182 144.203 202.277 146.225 202.583 148.432L202.669 149.685L202.718 205.022C202.745 207.376 201.871 209.651 200.275 211.381C198.679 213.111 196.482 214.165 194.134 214.326C191.786 214.488 189.464 213.746 187.646 212.251C185.828 210.757 184.65 208.623 184.354 206.288L184.28 205.035L184.231 149.698C184.231 147.253 185.202 144.908 186.931 143.179C188.66 141.45 191.005 140.479 193.45 140.479H193.438Z"
                  fill="#FF2020"
                  fillOpacity="0.85"
                />
                <path
                  className="errorsvg2"
                  d="M180.101 70.1951C186.217 66.8085 193.389 65.8639 200.174 67.5515C206.958 69.2391 212.852 73.4335 216.669 79.2909L217.689 80.9872L313.06 253.181C315.312 257.25 316.501 261.822 316.517 266.473C316.534 271.123 315.377 275.703 313.154 279.788C310.932 283.874 307.715 287.332 303.801 289.845C299.887 292.357 295.403 293.842 290.763 294.162L288.87 294.235H98.1526C93.5068 294.235 88.9359 293.065 84.8618 290.832C80.7877 288.6 77.3416 285.377 74.8417 281.461C72.3418 277.545 70.8687 273.063 70.5582 268.427C70.2477 263.792 71.1099 259.153 73.0653 254.939L73.9503 253.181L169.297 80.9872C171.811 76.4487 175.55 72.709 180.089 70.1951H180.101ZM296.933 262.105L201.55 89.9232C200.805 88.5816 199.736 87.4472 198.442 86.6231C197.147 85.7989 195.667 85.3109 194.136 85.2035C192.606 85.0961 191.072 85.3725 189.675 86.0078C188.278 86.6431 187.062 87.6171 186.136 88.8415L185.436 89.9232L90.0892 262.105C89.3582 263.422 88.961 264.898 88.9323 266.404C88.9037 267.91 89.2444 269.4 89.9248 270.743C90.6052 272.087 91.6044 273.244 92.8352 274.112C94.066 274.98 95.4907 275.534 96.9849 275.724L98.1526 275.798H288.87C290.375 275.797 291.858 275.427 293.187 274.721C294.516 274.015 295.653 272.994 296.497 271.747C297.341 270.501 297.867 269.067 298.028 267.57C298.19 266.074 297.983 264.56 297.425 263.162L296.933 262.105L201.55 89.9232L296.933 262.105V262.105ZM193.499 232.691C195.143 232.639 196.782 232.918 198.316 233.511C199.851 234.105 201.25 235 202.432 236.145C203.614 237.29 204.553 238.66 205.195 240.175C205.836 241.69 206.167 243.319 206.167 244.964C206.167 246.609 205.836 248.238 205.195 249.753C204.553 251.268 203.614 252.638 202.432 253.783C201.25 254.928 199.851 255.824 198.316 256.417C196.782 257.01 195.143 257.289 193.499 257.237C190.311 257.136 187.288 255.799 185.068 253.509C182.849 251.218 181.608 248.154 181.608 244.964C181.608 241.775 182.849 238.71 185.068 236.42C187.288 234.129 190.311 232.792 193.499 232.691V232.691ZM193.438 140.479C195.666 140.476 197.819 141.279 199.501 142.741C201.182 144.203 202.277 146.225 202.583 148.432L202.669 149.685L202.718 205.022C202.745 207.376 201.871 209.651 200.275 211.381C198.679 213.111 196.482 214.165 194.134 214.326C191.786 214.488 189.464 213.746 187.646 212.251C185.828 210.757 184.65 208.623 184.354 206.288L184.28 205.035L184.231 149.698C184.231 147.253 185.202 144.908 186.931 143.179C188.66 141.45 191.005 140.479 193.45 140.479H193.438Z"
                  fill="#FF2020"
                  fillOpacity="0.85"
                />
                <path
                  className="errorsvg3"
                  d="M180.101 70.1951C186.217 66.8085 193.389 65.8639 200.174 67.5515C206.958 69.2391 212.852 73.4335 216.669 79.2909L217.689 80.9872L313.06 253.181C315.312 257.25 316.501 261.822 316.517 266.473C316.534 271.123 315.377 275.703 313.154 279.788C310.932 283.874 307.715 287.332 303.801 289.845C299.887 292.357 295.403 293.842 290.763 294.162L288.87 294.235H98.1526C93.5068 294.235 88.9359 293.065 84.8618 290.832C80.7877 288.6 77.3416 285.377 74.8417 281.461C72.3418 277.545 70.8687 273.063 70.5582 268.427C70.2477 263.792 71.1099 259.153 73.0653 254.939L73.9503 253.181L169.297 80.9872C171.811 76.4487 175.55 72.709 180.089 70.1951H180.101ZM296.933 262.105L201.55 89.9232C200.805 88.5816 199.736 87.4472 198.442 86.6231C197.147 85.7989 195.667 85.3109 194.136 85.2035C192.606 85.0961 191.072 85.3725 189.675 86.0078C188.278 86.6431 187.062 87.6171 186.136 88.8415L185.436 89.9232L90.0892 262.105C89.3582 263.422 88.961 264.898 88.9323 266.404C88.9037 267.91 89.2444 269.4 89.9248 270.743C90.6052 272.087 91.6044 273.244 92.8352 274.112C94.066 274.98 95.4907 275.534 96.9849 275.724L98.1526 275.798H288.87C290.375 275.797 291.858 275.427 293.187 274.721C294.516 274.015 295.653 272.994 296.497 271.747C297.341 270.501 297.867 269.067 298.028 267.57C298.19 266.074 297.983 264.56 297.425 263.162L296.933 262.105L201.55 89.9232L296.933 262.105V262.105ZM193.499 232.691C195.143 232.639 196.782 232.918 198.316 233.511C199.851 234.105 201.25 235 202.432 236.145C203.614 237.29 204.553 238.66 205.195 240.175C205.836 241.69 206.167 243.319 206.167 244.964C206.167 246.609 205.836 248.238 205.195 249.753C204.553 251.268 203.614 252.638 202.432 253.783C201.25 254.928 199.851 255.824 198.316 256.417C196.782 257.01 195.143 257.289 193.499 257.237C190.311 257.136 187.288 255.799 185.068 253.509C182.849 251.218 181.608 248.154 181.608 244.964C181.608 241.775 182.849 238.71 185.068 236.42C187.288 234.129 190.311 232.792 193.499 232.691V232.691ZM193.438 140.479C195.666 140.476 197.819 141.279 199.501 142.741C201.182 144.203 202.277 146.225 202.583 148.432L202.669 149.685L202.718 205.022C202.745 207.376 201.871 209.651 200.275 211.381C198.679 213.111 196.482 214.165 194.134 214.326C191.786 214.488 189.464 213.746 187.646 212.251C185.828 210.757 184.65 208.623 184.354 206.288L184.28 205.035L184.231 149.698C184.231 147.253 185.202 144.908 186.931 143.179C188.66 141.45 191.005 140.479 193.45 140.479H193.438Z"
                  fill="#FF2020"
                  fillOpacity="0.85"
                />
              </g>
              <defs>
                <filter
                  id="filter1_d"
                  x="-24"
                  y="-30"
                  width="435"
                  height="435"
                  filterUnits="userSpaceOnUse"
                  colorInterpolationFilters="sRGB"
                >
                  <feFlood floodOpacity="0" result="BackgroundImageFix" />
                  <feColorMatrix
                    in="SourceAlpha"
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                  />
                  <feOffset dy="4" />
                  <feGaussianBlur stdDeviation="25" />
                  <feColorMatrix
                    type="matrix"
                    values="0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0"
                  />
                  <feBlend
                    mode="normal"
                    in2="BackgroundImageFix"
                    result="effect1_dropShadow"
                  />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="effect1_dropShadow"
                    result="shape"
                  />
                </filter>
              </defs>
            </svg>
            <p data-glitch={error !== "" ? error : "ERROR 404"}>
              {error !== "" ? error : "ERROR 404"}
            </p>
          </div>
        </div>
      ) : (
        <></>
      )}
    </>
  );
};

export default ErrorPopup;
